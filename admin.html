<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StyleHub 後台管理</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #f8f9fa;
        }
        .modal {
            display: none;
            transition: opacity 0.3s ease;
        }
        .modal.is-open {
            display: flex;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold text-gray-800">
                <a href="#">Style<span class="text-indigo-600">Hub</span> 後台</a>
            </div>
             <a href="index.html" target="_blank" class="text-blue-600 hover:text-blue-800 font-semibold">
                <i class="fas fa-store mr-1"></i>前往前台網站
            </a>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-12">

        <!-- 後台管理 Section -->
        <section id="admin-panel" class="bg-white p-8 rounded-xl shadow-lg border border-gray-200">
            <h2 class="text-3xl font-bold mb-6 border-b pb-4">商品管理系統</h2>
            
            <!-- 新增商品表單 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4">新增商品</h3>
                <form id="add-product-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <input type="text" id="product-name" placeholder="商品名稱" class="p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500" required>
                    <input type="text" id="product-sku" placeholder="商品編號 (SKU)" class="p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500" required>
                    <input type="number" id="product-price" placeholder="價格" class="p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500" required>
                    <input type="number" id="product-stock" placeholder="庫存數量" class="p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500" required>
                    <input type="text" id="product-image" placeholder="圖片網址 (可使用 placehold.co)" class="p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 col-span-1 md:col-span-2">
                    <textarea id="product-description" placeholder="商品描述" class="p-3 border rounded-lg col-span-1 md:col-span-2 h-24 focus:ring-2 focus:ring-indigo-500"></textarea>
                    <div class="col-span-1 md:col-span-2 flex items-center space-x-4">
                        <label class="flex items-center">
                            <input type="checkbox" id="product-is-featured" class="h-5 w-5 text-indigo-600 rounded">
                            <span class="ml-2 text-gray-700">設為熱門商品</span>
                        </label>
                    </div>
                    <div class="col-span-1 md:col-span-2">
                         <button type="submit" class="w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition duration-300">
                            <i class="fas fa-plus mr-2"></i>確認新增
                        </button>
                    </div>
                </form>
            </div>

            <!-- 商品管理列表 -->
            <div>
                <h3 class="text-xl font-semibold mb-4">管理現有商品</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-4">商品</th>
                                <th class="p-4">SKU</th>
                                <th class="p-4">價格</th>
                                <th class="p-4">庫存</th>
                                <th class="p-4">狀態</th>
                                <th class="p-4 text-center">操作</th>
                            </tr>
                        </thead>
                        <tbody id="admin-product-list">
                            <!-- Admin product list will be dynamically inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

    </main>
    
    <!-- 修改商品 Modal -->
    <div id="edit-modal" class="modal fixed inset-0 bg-black bg-opacity-50 justify-center items-center">
        <div class="bg-white p-8 rounded-lg shadow-xl w-11/12 md:w-1/2 lg:w-1/3 max-h-[90vh] overflow-y-auto">
            <h3 class="text-2xl font-bold mb-6">修改商品資訊</h3>
            <form id="edit-product-form">
                <input type="hidden" id="edit-product-id">
                <div class="space-y-4">
                     <input type="text" id="edit-product-name" placeholder="商品名稱" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500" required>
                     <input type="text" id="edit-product-sku" placeholder="商品編號 (SKU)" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500" required>
                     <input type="number" id="edit-product-price" placeholder="價格" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500" required>
                     <input type="number" id="edit-product-stock" placeholder="庫存數量" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500" required>
                     <input type="text" id="edit-product-image" placeholder="圖片網址" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500">
                     <textarea id="edit-product-description" placeholder="商品描述" class="w-full p-3 border rounded-lg h-24 focus:ring-2 focus:ring-indigo-500"></textarea>
                     <label class="flex items-center">
                         <input type="checkbox" id="edit-product-is-featured" class="h-5 w-5 text-indigo-600 rounded">
                         <span class="ml-2 text-gray-700">設為熱門商品</span>
                     </label>
                </div>
                <div class="mt-8 flex justify-end space-x-4">
                    <button type="button" id="cancel-edit" class="px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">取消</button>
                    <button type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">儲存變更</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- 資料管理 ---
        const initialProducts = [
            { id: 1, name: '法式亞麻寬鬆襯衫', sku: 'SHIRT-LNN-001', price: 1280, stock: 15, imageUrl: 'https://placehold.co/400x400/d1d5db/374151?text=Linen+Shirt', description: '採用高級亞麻製成，透氣舒適，是夏日衣櫥的必備單品。', is_featured: true },
            { id: 2, name: '高腰直筒牛仔褲', sku: 'JEANS-STR-002', price: 1880, stock: 8, imageUrl: 'https://placehold.co/400x400/93c5fd/1e3a8a?text=Straight+Jeans', description: '經典直筒剪裁，修飾腿型，打造復古時尚感。', is_featured: true },
            { id: 3, name: '都會防潑水風衣', sku: 'COAT-TRCH-001', price: 2980, stock: 5, imageUrl: 'https://placehold.co/400x400/fde68a/b45309?text=Trench+Coat', description: '輕量化防潑水面料，適合多變的都市天氣，兼具機能與時尚。', is_featured: false },
            { id: 4, name: '純棉印花 T-Shirt', sku: 'TEE-PRNT-005', price: 790, stock: 30, imageUrl: 'https://placehold.co/400x400/a7f3d0/065f46?text=Graphic+Tee', description: '柔軟的100%純棉，搭配原創設計印花，展現個人特色。', is_featured: true },
            { id: 5, name: 'A字雪紡長裙', sku: 'SKIRT-CHF-003', price: 1580, stock: 0, imageUrl: 'https://placehold.co/400x400/f9a8d4/831843?text=Chiffon+Skirt', description: '飄逸的雪紡材質，優雅的A字剪裁，散發浪漫氣息。', is_featured: true }
        ];

        function getProducts() {
            const productsFromStorage = localStorage.getItem('fashionProducts');
            if (productsFromStorage) {
                return JSON.parse(productsFromStorage);
            } else {
                localStorage.setItem('fashionProducts', JSON.stringify(initialProducts));
                return initialProducts;
            }
        }

        function saveProducts(products) {
            localStorage.setItem('fashionProducts', JSON.stringify(products));
        }

        let products = getProducts();

        // --- DOM 元素 ---
        const adminProductList = document.getElementById('admin-product-list');
        const addForm = document.getElementById('add-product-form');
        const editModal = document.getElementById('edit-modal');
        const editForm = document.getElementById('edit-product-form');
        const cancelEditBtn = document.getElementById('cancel-edit');
        
        // --- 核心功能函式 ---

        /**
         * 渲染後台商品列表
         */
        function renderAdminList() {
            // 清空現有內容
            adminProductList.innerHTML = '';

            // 渲染列表
            products.forEach(product => {
                const row = document.createElement('tr');
                row.classList.add('border-b');
                row.innerHTML = `
                    <td class="p-4 flex items-center space-x-3">
                        <img src="${product.imageUrl}" class="w-12 h-12 rounded-md object-cover" onerror="this.src='https://placehold.co/48x48/cccccc/333333?text=Img'">
                        <span class="font-medium">${product.name}</span>
                    </td>
                    <td class="p-4 text-gray-600">${product.sku}</td>
                    <td class="p-4 text-gray-600">NT$ ${product.price.toLocaleString()}</td>
                    <td class="p-4 text-gray-600">${product.stock}</td>
                    <td class="p-4">
                        ${product.is_featured ? '<span class="bg-indigo-100 text-indigo-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full">熱門</span>' : ''}
                        ${product.stock > 0 ? '<span class="bg-green-100 text-green-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full">現貨</span>' : '<span class="bg-red-100 text-red-800 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full">售完</span>'}
                    </td>
                    <td class="p-4 text-center">
                        <button class="text-indigo-600 hover:text-indigo-800 p-2 edit-btn" data-id="${product.id}"><i class="fas fa-edit"></i></button>
                        <button class="text-red-600 hover:text-red-800 p-2 delete-btn" data-id="${product.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                adminProductList.appendChild(row);
            });
            
            // 重新綁定編輯和刪除按鈕的事件監聽器
            addAdminButtonListeners();
        }
        
        /**
         * 為後台列表的按鈕們加上事件監聽器
         */
        function addAdminButtonListeners() {
            document.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', handleEdit);
            });
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', handleDelete);
            });
        }

        // --- 事件處理函式 ---

        /**
         * 處理新增商品
         */
        function handleAdd(e) {
            e.preventDefault();
            const newProduct = {
                id: Date.now(),
                name: document.getElementById('product-name').value,
                sku: document.getElementById('product-sku').value,
                price: parseFloat(document.getElementById('product-price').value),
                stock: parseInt(document.getElementById('product-stock').value),
                imageUrl: document.getElementById('product-image').value || `https://placehold.co/400x400/cccccc/333333?text=${document.getElementById('product-name').value}`,
                description: document.getElementById('product-description').value,
                is_featured: document.getElementById('product-is-featured').checked,
            };
            products.unshift(newProduct);
            saveProducts(products);
            renderAdminList();
            addForm.reset();
        }

        /**
         * 處理編輯商品 (開啟 Modal)
         */
        function handleEdit(e) {
            const id = parseInt(e.currentTarget.dataset.id);
            const productToEdit = products.find(p => p.id === id);
            
            document.getElementById('edit-product-id').value = productToEdit.id;
            document.getElementById('edit-product-name').value = productToEdit.name;
            document.getElementById('edit-product-sku').value = productToEdit.sku;
            document.getElementById('edit-product-price').value = productToEdit.price;
            document.getElementById('edit-product-stock').value = productToEdit.stock;
            document.getElementById('edit-product-image').value = productToEdit.imageUrl;
            document.getElementById('edit-product-description').value = productToEdit.description;
            document.getElementById('edit-product-is-featured').checked = productToEdit.is_featured;

            editModal.classList.add('is-open');
        }

        /**
         * 處理儲存編輯後的商品
         */
        function handleSaveEdit(e) {
            e.preventDefault();
            const id = parseInt(document.getElementById('edit-product-id').value);
            const productIndex = products.findIndex(p => p.id === id);

            if (productIndex > -1) {
                products[productIndex] = {
                    ...products[productIndex],
                    name: document.getElementById('edit-product-name').value,
                    sku: document.getElementById('edit-product-sku').value,
                    price: parseFloat(document.getElementById('edit-product-price').value),
                    stock: parseInt(document.getElementById('edit-product-stock').value),
                    imageUrl: document.getElementById('edit-product-image').value,
                    description: document.getElementById('edit-product-description').value,
                    is_featured: document.getElementById('edit-product-is-featured').checked,
                };
            }
            
            saveProducts(products);
            renderAdminList();
            closeEditModal();
        }

        /**
         * 處理刪除商品
         */
        function handleDelete(e) {
            const id = parseInt(e.currentTarget.dataset.id);
            const productName = products.find(p => p.id === id)?.name;
            if (confirm(`確定要刪除商品「${productName}」嗎？此操作無法復原。`)) {
                products = products.filter(p => p.id !== id);
                saveProducts(products);
                renderAdminList();
            }
        }
        
        /**
         * 關閉編輯 Modal
         */
        function closeEditModal() {
            editModal.classList.remove('is-open');
        }

        // --- 事件監聽器 ---
        document.addEventListener('DOMContentLoaded', renderAdminList);
        addForm.addEventListener('submit', handleAdd);
        editForm.addEventListener('submit', handleSaveEdit);
        cancelEditBtn.addEventListener('click', closeEditModal);
        
        editModal.addEventListener('click', (e) => {
            if (e.target === editModal) {
                closeEditModal();
            }
        });
    </script>
</body>
</html>
